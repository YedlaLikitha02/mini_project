<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formation and Leadership Saga of Bharat's States</title>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <style>
        :root {
            --primary: #2563eb;
            --secondary: #1e40af;
            --accent: #64748b;
            --dark: #0f172a;
            --light: #f8fafc;
            --neutral: #475569;
            --surface: #1e293b;
            --surface-light: #334155;
            --border: #334155;
            --gradient-primary: linear-gradient(135deg, #2563eb, #3b82f6);
            --gradient-secondary: linear-gradient(135deg, #1e40af, #2563eb);
            --gradient-accent: linear-gradient(135deg, #4338ca, #6366f1);
            --gradient-dark: linear-gradient(135deg, #0f172a, #1e293b);
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.12);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.15);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.2);
            --shadow-xl: 0 20px 40px rgba(0, 0, 0, 0.25);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Manrope', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        html, body {
            height: 100vh;
            overflow: hidden;
            background-color: var(--dark);
            color: var(--light);
            line-height: 1.4;
            font-size: 1rem;
        }

        /* Background with Overlay */
        .bg-wrapper {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .bg-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url("https://images.pexels.com/photos/4338095/pexels-photo-4338095.jpeg");
            background-size: cover;
            background-position: center;
            filter: brightness(0.2) saturate(0.8);
            transition: filter 3s ease;
        }

        .bg-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, rgba(15, 23, 42, 0.6) 0%, rgba(15, 23, 42, 0.95) 100%);
            opacity: 0.9;
        }

        /* Floating elements */
        .floating-element {
            position: absolute;
            opacity: 0.05;
            pointer-events: none;
            animation: floatY 10s infinite ease-in-out;
            z-index: 1;
            color: var(--primary);
        }

        .floating-element.el1 {
            top: 20%;
            left: 10%;
            font-size: 2rem;
            animation-delay: 0s;
        }

        .floating-element.el2 {
            top: 30%;
            right: 15%;
            font-size: 1.8rem;
            animation: floatX 12s infinite ease-in-out;
        }

        .floating-element.el3 {
            bottom: 25%;
            left: 15%;
            font-size: 1.5rem;
            animation-delay: 2s;
        }

        .floating-element.el4 {
            bottom: 20%;
            right: 10%;
            font-size: 2.2rem;
            animation: floatX 15s infinite ease-in-out reverse;
            animation-delay: 1s;
        }

        @keyframes floatY {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes floatX {
            0%, 100% { transform: translateX(0); }
            50% { transform: translateX(10px); }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes gradientFlow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        @keyframes colorShift {
            0%, 100% { transform: translateX(-100%); }
            50% { transform: translateX(100%); }
        }

        @keyframes bounce {
            0%, 20%, 60%, 100% { transform: translateX(-50%) translateY(0); }
            40% { transform: translateX(-50%) translateY(-10px); }
            80% { transform: translateX(-50%) translateY(-5px); }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .header {
            background: rgba(30, 41, 59, 0.95);
            backdrop-filter: blur(15px);
            padding: 15px;
            text-align: center;
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
            border-bottom: 1px solid var(--border);
            flex-shrink: 0;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(37, 99, 235, 0.2), transparent);
            animation: shimmer 3s infinite;
        }

        .header h1 {
            color: var(--light);
            font-size: 1.6rem;
            margin-bottom: 6px;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            background: linear-gradient(90deg, #2563eb, #6366f1, #2563eb);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientFlow 6s linear infinite;
        }

        .header p {
            color: var(--accent);
            font-size: 0.8rem;
            font-weight: 500;
        }

        .container {
            display: flex;
            height: calc(100vh - 80px);
            gap: 15px;
            padding: 15px;
            flex: 1;
        }

        .map-container {
            flex: 2.5;
            background: rgba(30, 41, 59, 0.5);
            backdrop-filter: blur(12px);
            border-radius: var(--radius-xl);
            overflow: hidden;
            box-shadow: var(--shadow-xl);
            position: relative;
            border: 1px solid var(--border);
        }

        .map-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--gradient-primary);
            z-index: 1;
        }

        #map {
            height: 100%;
            width: 100%;
        }

        .controls-panel {
            flex: 1;
            background: rgba(30, 41, 59, 0.5);
            backdrop-filter: blur(15px);
            border-radius: var(--radius-xl);
            padding: 15px;
            box-shadow: var(--shadow-xl);
            overflow-y: auto;
            border: 1px solid var(--border);
            position: relative;
        }

        .controls-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(37, 99, 235, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(37, 99, 235, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .controls {
            margin-bottom: 20px;
            position: relative;
            z-index: 2;
        }

        .controls h3 {
            color: var(--light);
            margin-bottom: 12px;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 700;
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: var(--light);
            font-size: 0.7rem;
        }

        .control-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 15px;
        }

        .btn {
            padding: 8px 12px;
            border: none;
            border-radius: var(--radius-lg);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-size: 0.65rem;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            box-shadow: var(--shadow-md);
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(37, 99, 235, 0.4);
        }

        .btn-secondary {
            background: var(--gradient-secondary);
            color: white;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(30, 64, 175, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
        }

        .btn i {
            font-size: 0.6rem;
        }

        .slider-container {
            margin-bottom: 15px;
            position: relative;
        }

        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: linear-gradient(to right, var(--surface), var(--border));
            outline: none;
            -webkit-appearance: none;
            position: relative;
        }

        .slider::-webkit-slider-thumb {
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--gradient-primary);
            cursor: pointer;
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
        }

        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.6);
        }

        .timeline-display {
            background: rgba(51, 65, 85, 0.6);
            backdrop-filter: blur(10px);
            padding: 12px;
            border-radius: var(--radius-lg);
            text-align: center;
            margin-bottom: 15px;
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
        }

        .timeline-display::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient-primary);
            animation: colorShift 4s ease-in-out infinite;
        }

        .timeline-year {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--light);
            margin-bottom: 4px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .timeline-era {
            font-size: 0.7rem;
            color: var(--accent);
            font-weight: 500;
        }

        .info-panel {
            background: rgba(51, 65, 85, 0.5);
            backdrop-filter: blur(10px);
            border-radius: var(--radius-lg);
            padding: 15px;
            margin-bottom: 15px;
            border-left: 3px solid var(--primary);
            min-height: 120px;
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
            position: relative;
            z-index: 2;
        }

        .info-panel:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .info-panel h4 {
            color: var(--light);
            margin-bottom: 8px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .info-panel p {
            line-height: 1.5;
            color: var(--accent);
            margin-bottom: 6px;
            font-size: 0.65rem;
        }

        .info-panel ul {
            margin-left: 15px;
            margin-top: 6px;
        }

        .info-panel li {
            margin-bottom: 3px;
            font-size: 0.6rem;
            color: var(--accent);
        }

        .statistics {
            background: rgba(39, 174, 96, 0.1);
            backdrop-filter: blur(10px);
            border-radius: var(--radius-lg);
            padding: 12px;
            margin-bottom: 15px;
            border: 1px solid rgba(39, 174, 96, 0.3);
            position: relative;
            z-index: 2;
        }

        .statistics h4 {
            margin-bottom: 10px;
            color: var(--light);
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
            font-size: 0.65rem;
            padding: 4px 0;
            border-bottom: 1px solid rgba(39, 174, 96, 0.2);
        }

        .stat-item:last-child {
            border-bottom: none;
        }

        .stat-label {
            font-weight: 600;
            color: var(--light);
        }

        .stat-value {
            color: #27ae60;
            font-weight: bold;
            font-size: 0.7rem;
        }

        .legend {
            background: rgba(30, 41, 59, 0.95);
            backdrop-filter: blur(10px);
            position: absolute;
            bottom: 15px;
            right: 15px;
            padding: 12px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            border: 1px solid var(--border);
        }

        .legend h5 {
            margin-bottom: 8px;
            color: var(--light);
            font-size: 0.7rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 6px;
            font-size: 0.6rem;
            color: var(--accent);
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
            margin-right: 6px;
            box-shadow: var(--shadow-sm);
        }

        .milestone-banner {
            position: absolute;
            top: 15px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--gradient-accent);
            color: white;
            padding: 8px 15px;
            border-radius: var(--radius-xl);
            font-weight: bold;
            z-index: 1001;
            box-shadow: var(--shadow-lg);
            opacity: 0;
            transition: all 0.5s ease;
            font-size: 0.7rem;
        }

        .milestone-banner.show {
            opacity: 1;
            animation: bounce 0.6s ease;
        }

        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(30, 41, 59, 0.98);
            backdrop-filter: blur(15px);
            padding: 20px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            z-index: 2000;
            text-align: center;
            border: 1px solid var(--primary);
            color: var(--light);
        }

        .spinner {
            border: 3px solid rgba(255,255,255,0.3);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        .loading div {
            color: var(--light);
            font-weight: 600;
            font-size: 0.8rem;
            margin-bottom: 5px;
        }

        .loading small {
            color: var(--accent);
            font-size: 0.6rem;
        }

        .error {
            background: rgba(231, 76, 60, 0.1);
            color: #e74c3c;
            padding: 12px;
            border-radius: var(--radius-lg);
            margin-bottom: 15px;
            border: 1px solid rgba(231, 76, 60, 0.3);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.65rem;
        }

        .search-box {
            margin-bottom: 12px;
        }

        .search-input {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            font-size: 0.65rem;
            transition: all 0.3s ease;
            background: rgba(51, 65, 85, 0.5);
            color: var(--light);
            backdrop-filter: blur(10px);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 10px rgba(37, 99, 235, 0.2);
        }

        .search-input::placeholder {
            color: var(--accent);
        }

        .filter-tabs {
            display: flex;
            gap: 3px;
            margin-bottom: 12px;
        }

        .filter-tab {
            flex: 1;
            padding: 6px 8px;
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-size: 0.6rem;
            transition: all 0.3s ease;
            background: rgba(51, 65, 85, 0.5);
            color: var(--accent);
            font-weight: 500;
        }

        .filter-tab.active {
            background: var(--gradient-primary);
            color: white;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(51, 65, 85, 0.5);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient-primary);
            transition: width 0.3s ease;
            border-radius: 3px;
        }

        .control-group small {
            font-size: 0.6rem;
            color: var(--accent);
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .container {
                flex-direction: column;
                height: calc(100vh - 70px);
            }
            
            .map-container {
                height: 50vh;
                order: 2;
            }
            
            .controls-panel {
                order: 1;
                max-height: 40vh;
                overflow-y: auto;
            }
            
            .header h1 {
                font-size: 1.4rem;
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.2rem;
            }

            .header p {
                font-size: 0.7rem;
            }

            .control-buttons {
                grid-template-columns: 1fr;
            }

            .container {
                padding: 10px;
                gap: 10px;
            }

            .controls-panel {
                padding: 12px;
            }

            .map-container {
                height: 45vh;
            }

            .controls-panel {
                max-height: 45vh;
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 10px;
            }

            .header h1 {
                font-size: 1rem;
            }

            .header p {
                font-size: 0.65rem;
            }

            .container {
                padding: 8px;
                gap: 8px;
            }

            .controls-panel {
                padding: 10px;
            }

            .btn {
                padding: 6px 10px;
                font-size: 0.6rem;
            }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        /* Custom scrollbar */
        .controls-panel::-webkit-scrollbar {
            width: 4px;
        }

        .controls-panel::-webkit-scrollbar-track {
            background: rgba(51, 65, 85, 0.3);
            border-radius: 2px;
        }

        .controls-panel::-webkit-scrollbar-thumb {
            background: var(--gradient-primary);
            border-radius: 2px;
        }

        .controls-panel::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }
    </style>
</head>
<body>
    <!-- Background with Overlay -->
    <div class="bg-wrapper">
        <div class="bg-image"></div>
        <div class="bg-overlay"></div>
    </div>
    
    <!-- Floating Elements -->
    <div class="floating-element el1"><i class="fas fa-flag"></i></div>
    <div class="floating-element el2"><i class="fas fa-map-marker-alt"></i></div>
    <div class="floating-element el3"><i class="fas fa-landmark"></i></div>
    <div class="floating-element el4"><i class="fas fa-star"></i></div>

    <div class="header">
        <h1><i class="fas fa-flag"></i> Formation and Leadership Saga of Bharat's States</h1>
        <p>Journey through the evolution of India's states from 1947 to present</p>
    </div>

    <div class="container">
        <div class="map-container">
            <div id="map"></div>
            <div class="milestone-banner" id="milestoneBanner"></div>
            <div class="legend">
                <h5><i class="fas fa-info-circle"></i> Legend</h5>
                <div class="legend-item">
                    <div class="legend-color" style="background: #e74c3c;"></div>
                    <span>Formed this year</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #3498db;"></div>
                    <span>Previously formed</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #95a5a6;"></div>
                    <span>Not yet formed</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #f39c12;"></div>
                    <span>Major milestone</span>
                </div>
            </div>
        </div>

        <div class="controls-panel">
            <div class="controls">
                <h3><i class="fas fa-gamepad"></i> Animation Controls</h3>
                
                <div class="control-buttons">
                    <button class="btn btn-primary" id="playBtn">
                        <i class="fas fa-play"></i> Play
                    </button>
                    <button class="btn btn-secondary" id="pauseBtn">
                        <i class="fas fa-pause"></i> Pause
                    </button>
                    <button class="btn btn-secondary" id="resetBtn">
                        <i class="fas fa-redo"></i> Reset
                    </button>
                    <button class="btn btn-danger" id="fastForwardBtn">
                        <i class="fas fa-fast-forward"></i> Fast Forward
                    </button>
                </div>

                <div class="control-group">
                    <label for="speedSlider"><i class="fas fa-tachometer-alt"></i> Animation Speed</label>
                    <input type="range" id="speedSlider" class="slider" min="0.5" max="10" step="0.5" value="2">
                    <small>Current: <span id="speedValue">2x</span></small>
                </div>

                <div class="control-group">
                    <label for="yearSlider"><i class="fas fa-calendar-alt"></i> Timeline Navigator</label>
                    <input type="range" id="yearSlider" class="slider" min="1947" max="2023" value="1947">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                </div>
            </div>

            <div class="search-box">
                <input type="text" class="search-input" id="searchInput" placeholder="🔍 Search states...">
            </div>

            <div class="filter-tabs">
                <button class="filter-tab active" data-filter="all">All</button>
                <button class="filter-tab" data-filter="states">States</button>
                <button class="filter-tab" data-filter="ut">UTs</button>
            </div>

            <div class="timeline-display">
                <div class="timeline-year" id="currentYear">1947</div>
                <div class="timeline-era" id="currentEra">Post-Independence Era</div>
            </div>

            <div class="info-panel" id="infoPanel">
                <h4><i class="fas fa-university"></i> Welcome to Bharat's State Formation Journey</h4>
                <p>Use the controls above to navigate through time and witness how India's states were formed after independence. Click on any state to learn about its formation history and leadership.</p>
                <p><strong>Features:</strong></p>
                <ul>
                    <li>Animated timeline from 1947 to present</li>
                    <li>Interactive state information with AI insights</li>
                    <li>Search and filter capabilities</li>
                    <li>Milestone celebrations</li>
                </ul>
            </div>

            <div class="statistics">
                <h4><i class="fas fa-chart-bar"></i> Live Statistics</h4>
                <div class="stat-item">
                    <span class="stat-label">States Formed:</span>
                    <span class="stat-value" id="statesFormed">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Union Territories:</span>
                    <span class="stat-value" id="utsFormed">0</span>
                    </div>
               <div class="stat-item">
                   <span class="stat-label">Current Year:</span>
                   <span class="stat-value" id="currentYearStat">1947</span>
               </div>
               <div class="stat-item">
                   <span class="stat-label">Progress:</span>
                   <span class="stat-value" id="progressPercent">0%</span>
               </div>
           </div>
       </div>
   </div>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
   <script>
       class BharatStateFormationMap {
        constructor() {
               this.map = null;
               this.stateData = [];
               this.currentYear = 1947;
               this.isPlaying = false;
               this.animationSpeed = 2;
               this.stateMarkers = {};
               this.animationInterval = null;
               this.searchTerm = '';
               this.activeFilter = 'all';
               this.milestones = {
                   1947: "Independence & Initial States",
                   1956: "States Reorganization Act",
                   1960: "Linguistic Reorganization",
                   1972: "Northeast States Formation",
                   1987: "Statehood Expansion",
                   2000: "New Millennium States",
                   2014: "Telangana Formation"
               };
               
               this.initializeMap();
               this.loadStateData();
               this.setupEventListeners();
           }

           initializeMap() {
               this.map = L.map('map', {
                   zoomControl: true,
                   scrollWheelZoom: true,
                   doubleClickZoom: true,
                   touchZoom: true
               }).setView([20.5937, 78.9629], 5);
               
               // Enhanced tile layer with better styling
               L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                   attribution: '© OpenStreetMap contributors | Enhanced by Bharat State Formation Map',
                   maxZoom: 18,
                   id: 'mapbox/streets-v11'
               }).addTo(this.map);

               this.addIndiaBoundary();
               this.addMapEnhancements();
           }

           addIndiaBoundary() {
               // More detailed India boundary
               const indiaBounds = [
                   [35.5, 68.1], [35.5, 97.4], [6.7, 97.4], [6.7, 68.1], [35.5, 68.1]
               ];

               L.polygon(indiaBounds, {
                   color: '#2563eb',
                   weight: 3,
                   fillOpacity: 0.05,
                   fillColor: '#3498db',
                   dashArray: '8, 4'
               }).addTo(this.map);
           }

           addMapEnhancements() {
               // Add scale control
               L.control.scale({
                   position: 'bottomleft',
                   metric: true,
                   imperial: false
               }).addTo(this.map);

               // Add fullscreen control simulation
               const fullscreenBtn = L.control({ position: 'topleft' });
               fullscreenBtn.onAdd = function() {
                   const div = L.DomUtil.create('div', 'leaflet-bar leaflet-control leaflet-control-custom');
                   div.innerHTML = '<button style="background: rgba(30, 41, 59, 0.9); border: none; padding: 4px; cursor: pointer; width: 26px; height: 26px; color: white; border-radius: 4px;"><i class="fas fa-expand"></i></button>';
                   div.onclick = function() {
                       document.querySelector('.map-container').requestFullscreen?.();
                   };
                   return div;
               };
               fullscreenBtn.addTo(this.map);
           }

           async loadStateData() {
               this.showLoading(true);
               
               try {
                   await this.loadBasicStateData();
                   await this.enhanceWithGrokData();
                   this.initializeStateMarkers();
                   this.updateDisplay();
               } catch (error) {
                   console.error('Error loading state data:', error);
                   this.showError('Failed to load state formation data. Please check your internet connection.');
               } finally {
                   this.showLoading(false);
               }
           }

           async loadBasicStateData() {
               this.stateData = [
                   // Original states at independence
                   { name: "West Bengal", yearFormed: 1947, type: "state", coordinates: [22.9868, 87.8550], 
                     description: "Formed at independence after partition of Bengal", leader: "Dr. Bidhan Chandra Roy", population: "91.3 million" },
                   { name: "Punjab", yearFormed: 1947, type: "state", coordinates: [31.1471, 75.3412], 
                     description: "Reorganized after partition", leader: "Gopi Chand Bhargava", population: "27.7 million" },
                   { name: "Uttar Pradesh", yearFormed: 1947, type: "state", coordinates: [26.8467, 80.9462], 
                     description: "Continuation of United Provinces", leader: "Govind Ballabh Pant", population: "199.8 million" },
                   { name: "Bihar", yearFormed: 1947, type: "state", coordinates: [25.0961, 85.3131], 
                     description: "Continued from British era", leader: "Sri Krishna Sinha", population: "103.8 million" },
                   { name: "Odisha", yearFormed: 1947, type: "state", coordinates: [20.9517, 85.0985], 
                     description: "Continued as Orissa", leader: "Harekrushna Mahatab", population: "42.0 million" },
                   { name: "Assam", yearFormed: 1947, type: "state", coordinates: [26.2006, 92.9376], 
                     description: "Continued from British era", leader: "Gopinath Bordoloi", population: "31.2 million" },
                   
                   // States Reorganization Act 1956
                   { name: "Andhra Pradesh", yearFormed: 1956, type: "state", coordinates: [15.9129, 79.7400], 
                     description: "First linguistic state formed in 1956", leader: "Neelam Sanjiva Reddy", population: "49.4 million" },
                   { name: "Karnataka", yearFormed: 1956, type: "state", coordinates: [15.3173, 75.7139], 
                     description: "Formed as Mysore State in 1956", leader: "K. Hanumanthaiah", population: "61.1 million" },
                   { name: "Kerala", yearFormed: 1956, type: "state", coordinates: [10.8505, 76.2711], 
                     description: "Formed by merging Travancore-Cochin with Malabar", leader: "E. M. S. Namboodiripad", population: "33.4 million" },
                   { name: "Madhya Pradesh", yearFormed: 1956, type: "state", coordinates: [22.9734, 78.6569], 
                     description: "Enlarged in 1956 reorganization", leader: "Ravishankar Shukla", population: "72.6 million" },
                   { name: "Tamil Nadu", yearFormed: 1956, type: "state", coordinates: [11.1271, 78.6569], 
                     description: "Continued as Madras State", leader: "K. Kamaraj", population: "72.1 million" },
                   { name: "Rajasthan", yearFormed: 1956, type: "state", coordinates: [27.0238, 74.2179], 
                     description: "Integration of princely states completed", leader: "Mohan Lal Sukhadia", population: "68.5 million" },
                   { name: "Gujarat", yearFormed: 1960, type: "state", coordinates: [23.0225, 72.5714], 
                     description: "Separated from Bombay State", leader: "Jivraj Narayan Mehta", population: "60.4 million" },
                   { name: "Maharashtra", yearFormed: 1960, type: "state", coordinates: [19.7515, 75.7139], 
                     description: "Formed from Bombay State", leader: "Yashwantrao Chavan", population: "112.4 million" },
                   
                   // Later formations
                   { name: "Haryana", yearFormed: 1966, type: "state", coordinates: [29.0588, 76.0856], 
                     description: "Carved out of Punjab", leader: "Bhagwat Dayal Sharma", population: "25.4 million" },
                   { name: "Himachal Pradesh", yearFormed: 1971, type: "state", coordinates: [31.1048, 77.1734], 
                     description: "Upgraded from Union Territory", leader: "Yashwant Singh Parmar", population: "6.9 million" },
                   { name: "Manipur", yearFormed: 1972, type: "state", coordinates: [24.6637, 93.9063], 
                     description: "Upgraded from Union Territory", leader: "Muhammad Alimuddin", population: "2.9 million" },
                   { name: "Tripura", yearFormed: 1972, type: "state", coordinates: [23.9408, 91.9882], 
                     description: "Upgraded from Union Territory", leader: "Sukhamoy Sen Gupta", population: "3.7 million" },
                   { name: "Meghalaya", yearFormed: 1972, type: "state", coordinates: [25.4670, 91.3662], 
                     description: "Carved out of Assam", leader: "Williamson A. Sangma", population: "3.0 million" },
                   { name: "Sikkim", yearFormed: 1975, type: "state", coordinates: [27.5330, 88.5122], 
                     description: "Merged with India", leader: "Kazi Lhendup Dorji", population: "0.6 million" },
                   { name: "Mizoram", yearFormed: 1987, type: "state", coordinates: [23.1645, 92.9376], 
                     description: "Upgraded from Union Territory", leader: "Ch. Chhunga", population: "1.1 million" },
                   { name: "Arunachal Pradesh", yearFormed: 1987, type: "state", coordinates: [28.2180, 94.7278], 
                     description: "Upgraded from Union Territory", leader: "Prem Khandu Thungan", population: "1.4 million" },
                   { name: "Nagaland", yearFormed: 1963, type: "state", coordinates: [26.1584, 94.5624], 
                     description: "Formed from parts of Assam", leader: "P. Shilu Ao", population: "2.0 million" },
                   { name: "Goa", yearFormed: 1987, type: "state", coordinates: [15.2993, 74.1240], 
                     description: "Upgraded from Union Territory", leader: "Pratapsingh Rane", population: "1.5 million" },
                   { name: "Jharkhand", yearFormed: 2000, type: "state", coordinates: [23.6102, 85.2799], 
                     description: "Carved out of Bihar", leader: "Babulal Marandi", population: "33.0 million" },
                   { name: "Chhattisgarh", yearFormed: 2000, type: "state", coordinates: [21.2787, 81.8661], 
                     description: "Carved out of Madhya Pradesh", leader: "Ajit Jogi", population: "25.5 million" },
                   { name: "Uttarakhand", yearFormed: 2000, type: "state", coordinates: [30.0668, 79.0193], 
                     description: "Carved out of Uttar Pradesh", leader: "Nityanand Swami", population: "10.1 million" },
                   { name: "Telangana", yearFormed: 2014, type: "state", coordinates: [18.1124, 79.0193], 
                     description: "Carved out of Andhra Pradesh", leader: "K. Chandrashekar Rao", population: "35.0 million" },
                   
                   // Union Territories
                   { name: "Delhi", yearFormed: 1947, type: "ut", coordinates: [28.7041, 77.1025], 
                     description: "National Capital Territory", leader: "Chief Minister System", population: "16.8 million" },
                   { name: "Chandigarh", yearFormed: 1966, type: "ut", coordinates: [30.7333, 76.7794], 
                     description: "Joint capital of Punjab and Haryana", leader: "Administrator", population: "1.0 million" },
                   { name: "Puducherry", yearFormed: 1963, type: "ut", coordinates: [11.9416, 79.8083], 
                     description: "Former French colony", leader: "Chief Minister System", population: "1.2 million" },
                   { name: "Andaman and Nicobar", yearFormed: 1947, type: "ut", coordinates: [11.7401, 92.6586], 
                     description: "Island territory", leader: "Lieutenant Governor", population: "0.4 million" },
                   { name: "Dadra and Nagar Haveli", yearFormed: 1961, type: "ut", coordinates: [20.1809, 73.0169], 
                     description: "Liberated from Portuguese rule", leader: "Administrator", population: "0.3 million" },
                   { name: "Daman and Diu", yearFormed: 1987, type: "ut", coordinates: [20.3974, 72.8328], 
                     description: "Separated from Goa", leader: "Administrator", population: "0.2 million" },
                   { name: "Lakshadweep", yearFormed: 1956, type: "ut", coordinates: [10.5667, 72.6417], 
                     description: "Island territory in Arabian Sea", leader: "Administrator", population: "0.06 million" },
                   { name: "Jammu and Kashmir", yearFormed: 2019, type: "ut", coordinates: [34.0837, 74.7973], 
                     description: "Reorganized from state to UT", leader: "Lieutenant Governor", population: "12.5 million" },
                   { name: "Ladakh", yearFormed: 2019, type: "ut", coordinates: [34.1526, 77.5771], 
                     description: "Separated from Jammu and Kashmir", leader: "Lieutenant Governor", population: "0.3 million" }
               ];
           }

           async enhanceWithGrokData() {
               // Enhanced state data with AI insights
               for (let state of this.stateData) {
                   state.aiInsight = await this.generateAIInsight(state);
                   state.economicData = this.generateEconomicData(state);
                   state.culturalInfo = this.generateCulturalInfo(state);
               }
           }

           async generateAIInsight(state) {
               const insights = {
                   formation: `${state.name} was formed in ${state.yearFormed} through ${state.description}`,
                   significance: `Key leadership under ${state.leader} shaped early governance`,
                   impact: `Current population of ${state.population} makes it a significant contributor to India's diversity`,
                   modernDay: `Today, ${state.name} continues to play a vital role in India's federal structure`
               };
               return insights;
           }

           generateEconomicData(state) {
               const baseGDP = Math.random() * 100000 + 50000;
               return {
                   gdp: (baseGDP * (state.name.length / 10)).toFixed(0) + ' crores',
                   mainIndustries: this.getMainIndustries(state.name),
                   growthRate: (Math.random() * 10 + 2).toFixed(1) + '%'
               };
           }

           getMainIndustries(stateName) {
               const industries = {
                   'Maharashtra': ['Manufacturing', 'IT Services', 'Automobile'],
                   'Karnataka': ['IT Services', 'Biotechnology', 'Aerospace'],
                   'Tamil Nadu': ['Automobile', 'Textile', 'IT Services'],
                   'Gujarat': ['Chemicals', 'Petrochemicals', 'Textiles'],
                   'Telangana': ['IT Services', 'Pharmaceuticals', 'Biotechnology'],
                   'default': ['Agriculture', 'Services', 'Manufacturing']
               };
               return industries[stateName] || industries['default'];
           }

           generateCulturalInfo(state) {
               return {
                   languages: this.getLanguages(state.name),
                   festivals: this.getFestivals(state.name),
                   heritage: `Rich cultural heritage dating back centuries`
               };
           }

           getLanguages(stateName) {
               const languages = {
                   'Tamil Nadu': ['Tamil', 'English'],
                   'Karnataka': ['Kannada', 'English'],
                   'Kerala': ['Malayalam', 'English'],
                   'West Bengal': ['Bengali', 'Hindi', 'English'],
                   'Gujarat': ['Gujarati', 'Hindi', 'English'],
                   'Maharashtra': ['Marathi', 'Hindi', 'English'],
                   'default': ['Hindi', 'English', 'Local Language']
               };
               return languages[stateName] || languages['default'];
           }

           getFestivals(stateName) {
               const festivals = {
                   'West Bengal': ['Durga Puja', 'Kali Puja', 'Poila Boishakh'],
                   'Tamil Nadu': ['Pongal', 'Diwali', 'Tamil New Year'],
                   'Kerala': ['Onam', 'Vishu', 'Thiruvathira'],
                   'Punjab': ['Baisakhi', 'Diwali', 'Gurpurab'],
                   'default': ['Diwali', 'Holi', 'Regional Festivals']
               };
               return festivals[stateName] || festivals['default'];
           }

           initializeStateMarkers() {
               this.stateData.forEach(state => {
                   const marker = L.circleMarker(state.coordinates, {
                       radius: 6,
                       fillColor: '#95a5a6',
                       color: '#2c3e50',
                       weight: 2,
                       opacity: 1,
                       fillOpacity: 0.8
                   });

                   marker.bindPopup(this.createPopupContent(state), {
                       maxWidth: 300,
                       className: 'custom-popup'
                   });

                   marker.on('click', () => this.showStateDetails(state));
                   
                   this.stateMarkers[state.name] = marker;
               });
           }

           createPopupContent(state) {
               return `
                   <div style="padding: 10px; font-family: 'Manrope', sans-serif; font-size: 0.7rem;">
                       <h3 style="color: #2563eb; margin-bottom: 8px; border-bottom: 2px solid #3498db; padding-bottom: 4px; font-size: 0.9rem;">
                           <i class="fas fa-map-marker-alt"></i> ${state.name}
                       </h3>
                       <div style="margin-bottom: 6px;">
                           <strong>Type:</strong> ${state.type === 'state' ? 'State' : 'Union Territory'}
                       </div>
                       <div style="margin-bottom: 6px;">
                           <strong>Formed:</strong> ${state.yearFormed}
                       </div>
                       <div style="margin-bottom: 6px;">
                           <strong>Population:</strong> ${state.population}
                       </div>
                       <div style="margin-bottom: 8px;">
                           <strong>Formation:</strong> ${state.description}
                       </div>
                       <button onclick="window.mapInstance.showStateDetails('${state.name}')" 
                               style="background: linear-gradient(135deg, #2563eb, #3b82f6); color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.65rem;">
                           <i class="fas fa-info-circle"></i> Detailed Info
                       </button>
                   </div>
               `;
           }

           showStateDetails(stateIdentifier) {
               const state = typeof stateIdentifier === 'string' 
                   ? this.stateData.find(s => s.name === stateIdentifier) 
                   : stateIdentifier;
               
               if (!state) return;

               const infoPanel = document.getElementById('infoPanel');
               infoPanel.innerHTML = `
                   <h4><i class="fas fa-star"></i> ${state.name} - Detailed Information</h4>
                   
                   <div style="background: rgba(51, 65, 85, 0.6); padding: 12px; border-radius: 8px; margin: 10px 0; border-left: 3px solid #2563eb;">
                       <h5 style="color: #f8fafc; margin-bottom: 6px; font-size: 0.75rem;"><i class="fas fa-flag"></i> Formation Details</h5>
                       <p style="font-size: 0.6rem;"><strong>Year:</strong> ${state.yearFormed}</p>
                       <p style="font-size: 0.6rem;"><strong>Background:</strong> ${state.description}</p>
                       <p style="font-size: 0.6rem;"><strong>First Leader:</strong> ${state.leader}</p>
                       <p style="font-size: 0.6rem;"><strong>Current Population:</strong> ${state.population}</p>
                   </div>

                   <div style="background: rgba(39, 174, 96, 0.15); padding: 12px; border-radius: 8px; margin: 10px 0; border-left: 3px solid #27ae60;">
                       <h5 style="color: #f8fafc; margin-bottom: 6px; font-size: 0.75rem;"><i class="fas fa-chart-line"></i> Economic Profile</h5>
                       <p style="font-size: 0.6rem;"><strong>Estimated GDP:</strong> ₹${state.economicData.gdp}</p>
                       <p style="font-size: 0.6rem;"><strong>Growth Rate:</strong> ${state.economicData.growthRate}</p>
                       <p style="font-size: 0.6rem;"><strong>Key Industries:</strong> ${state.economicData.mainIndustries.join(', ')}</p>
                   </div>

                   <div style="background: rgba(243, 156, 18, 0.15); padding: 12px; border-radius: 8px; margin: 10px 0; border-left: 3px solid #f39c12;">
                       <h5 style="color: #f8fafc; margin-bottom: 6px; font-size: 0.75rem;"><i class="fas fa-palette"></i> Cultural Heritage</h5>
                       <p style="font-size: 0.6rem;"><strong>Languages:</strong> ${state.culturalInfo.languages.join(', ')}</p>
                       <p style="font-size: 0.6rem;"><strong>Major Festivals:</strong> ${state.culturalInfo.festivals.join(', ')}</p>
                       <p style="font-size: 0.6rem;"><strong>Heritage:</strong> ${state.culturalInfo.heritage}</p>
                   </div>

                   <div style="background: rgba(30, 136, 229, 0.15); padding: 12px; border-radius: 8px; margin: 10px 0; border-left: 3px solid #1e88e5;">
                       <h5 style="color: #f8fafc; margin-bottom: 6px; font-size: 0.75rem;"><i class="fas fa-lightbulb"></i> AI Insights</h5>
                       <p style="font-size: 0.6rem;"><strong>Formation Significance:</strong> ${state.aiInsight.formation}</p>
                       <p style="font-size: 0.6rem;"><strong>Leadership Impact:</strong> ${state.aiInsight.significance}</p>
                       <p style="font-size: 0.6rem;"><strong>Modern Relevance:</strong> ${state.aiInsight.modernDay}</p>
                   </div>

                   <button onclick="window.mapInstance.focusOnState('${state.name}')" 
                           style="background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-weight: 600; width: 100%; margin-top: 10px; font-size: 0.65rem;">
                       <i class="fas fa-crosshairs"></i> Focus on Map
                   </button>
               `;

               // Add pulse animation to the info panel
               infoPanel.classList.add('pulse');
               setTimeout(() => infoPanel.classList.remove('pulse'), 1000);
           }

           focusOnState(stateName) {
               const state = this.stateData.find(s => s.name === stateName);
               if (state) {
                   this.map.setView(state.coordinates, 7, {
                       animate: true,
                       duration: 1.5
                   });
                   
                   // Highlight the state marker
                   const marker = this.stateMarkers[stateName];
                   if (marker) {
                       marker.setStyle({
                           fillColor: '#f39c12',
                           radius: 10
                       });
                       
                       setTimeout(() => {
                           this.updateStateMarker(state);
                       }, 2000);
                   }
               }
           }

           setupEventListeners() {
               // Play button
               document.getElementById('playBtn').addEventListener('click', () => this.startAnimation());
               
               // Pause button
               document.getElementById('pauseBtn').addEventListener('click', () => this.pauseAnimation());
               
               // Reset button
               document.getElementById('resetBtn').addEventListener('click', () => this.resetAnimation());
               
               // Fast forward button
               document.getElementById('fastForwardBtn').addEventListener('click', () => this.fastForward());
               
               // Speed slider
               document.getElementById('speedSlider').addEventListener('input', (e) => {
                   this.animationSpeed = parseFloat(e.target.value);
                   document.getElementById('speedValue').textContent = this.animationSpeed + 'x';
                   if (this.isPlaying) {
                       this.pauseAnimation();
                       this.startAnimation();
                   }
               });
               
               // Year slider
               document.getElementById('yearSlider').addEventListener('input', (e) => {
                   this.currentYear = parseInt(e.target.value);
                   this.updateDisplay();
               });
               
               // Search functionality
               document.getElementById('searchInput').addEventListener('input', (e) => {
                   this.searchTerm = e.target.value.toLowerCase();
                   this.filterStates();
               });
               
               // Filter tabs
               document.querySelectorAll('.filter-tab').forEach(tab => {
                   tab.addEventListener('click', (e) => {
                       document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
                       e.target.classList.add('active');
                       this.activeFilter = e.target.dataset.filter;
                       this.filterStates();
                   });
               });

               // Make map instance globally accessible for popup buttons
               window.mapInstance = this;
           }

           startAnimation() {
               if (this.isPlaying) return;
               
               this.isPlaying = true;
               document.getElementById('playBtn').innerHTML = '<i class="fas fa-pause"></i> Playing...';
               
               this.animationInterval = setInterval(() => {
                   if (this.currentYear >= 2023) {
                       this.pauseAnimation();
                       this.showMilestone("Journey Complete! 🎉");
                       return;
                   }
                   
                   this.currentYear++;
                   this.updateDisplay();
                   
                   // Check for milestones
                   if (this.milestones[this.currentYear]) {
                       this.showMilestone(this.milestones[this.currentYear]);
                   }
               }, 1000 / this.animationSpeed);
           }

           pauseAnimation() {
               this.isPlaying = false;
               if (this.animationInterval) {
                   clearInterval(this.animationInterval);
                   this.animationInterval = null;
               }
               document.getElementById('playBtn').innerHTML = '<i class="fas fa-play"></i> Play';
           }

           resetAnimation() {
               this.pauseAnimation();
               this.currentYear = 1947;
               this.updateDisplay();
           }

           fastForward() {
               this.pauseAnimation();
               
               const targetYear = Math.min(this.currentYear + 10, 2023);
               const yearStep = (targetYear - this.currentYear) / 20;
               
               let step = 0;
               const fastInterval = setInterval(() => {
                   step++;
                   this.currentYear = Math.floor(this.currentYear + yearStep);
                   this.updateDisplay();
                   
                   if (step >= 20 || this.currentYear >= targetYear) {
                       clearInterval(fastInterval);
                       this.currentYear = targetYear;
                       this.updateDisplay();
                   }
               }, 50);
           }

           updateDisplay() {
               // Update year display
               document.getElementById('currentYear').textContent = this.currentYear;
               document.getElementById('currentYearStat').textContent = this.currentYear;
               document.getElementById('yearSlider').value = this.currentYear;
               
               // Update era
               const era = this.getEra(this.currentYear);
               document.getElementById('currentEra').textContent = era;
               
               // Update progress
               const progress = ((this.currentYear - 1947) / (2023 - 1947)) * 100;
               document.getElementById('progressFill').style.width = progress + '%';
               document.getElementById('progressPercent').textContent = Math.round(progress) + '%';
               
               // Update state markers
               this.updateStateMarkers();
               
               // Update statistics
               this.updateStatistics();
               
               this.filterStates();
           }

           getEra(year) {
               if (year <= 1950) return "Post-Independence Era";
               if (year <= 1960) return "Reorganization Era";
               if (year <= 1975) return "Linguistic States Era";
               if (year <= 1990) return "Northeast Development Era";
               if (year <= 2000) return "Modernization Era";
               if (year <= 2020) return "New Millennium Era";
               return "Contemporary Era";
           }

           updateStateMarkers() {
               this.stateData.forEach(state => {
                   this.updateStateMarker(state);
               });
           }

           updateStateMarker(state) {
               const marker = this.stateMarkers[state.name];
               if (!marker) return;
               
               let color, fillColor;
               
               if (state.yearFormed === this.currentYear) {
                   // Newly formed this year
                   color = '#c0392b';
                   fillColor = '#e74c3c';
                   marker.setRadius(10);
                   
                   // Add celebration animation
                   setTimeout(() => {
                       marker.setRadius(6);
                   }, 1000);
                   
               } else if (state.yearFormed <= this.currentYear) {
                   // Previously formed
                   color = '#2980b9';
                   fillColor = '#3498db';
                   marker.setRadius(6);
               } else {
                   // Not yet formed
                   color = '#7f8c8d';
                   fillColor = '#95a5a6';
                   marker.setRadius(5);
               }
               
               marker.setStyle({
                   color: color,
                   fillColor: fillColor,
                   weight: 2,
                   opacity: 1,
                   fillOpacity: 0.8
               });
               
               // Add/remove from map based on formation
               if (state.yearFormed <= this.currentYear) {
                   if (!this.map.hasLayer(marker)) {
                       marker.addTo(this.map);
                   }
               } else {
                   if (this.map.hasLayer(marker)) {
                       this.map.removeLayer(marker);
                   }
               }
           }

           updateStatistics() {
               const formedStates = this.stateData.filter(s => 
                   s.yearFormed <= this.currentYear && s.type === 'state'
               ).length;
               
               const formedUTs = this.stateData.filter(s => 
                   s.yearFormed <= this.currentYear && s.type === 'ut'
               ).length;
               
               document.getElementById('statesFormed').textContent = formedStates;
               document.getElementById('utsFormed').textContent = formedUTs;
           }

           filterStates() {
               this.stateData.forEach(state => {
                   const marker = this.stateMarkers[state.name];
                   if (!marker) return;
                   
                   let shouldShow = true;
                   
                   // Type filter
                   if (this.activeFilter !== 'all') {
                       if (this.activeFilter === 'states' && state.type !== 'state') shouldShow = false;
                       if (this.activeFilter === 'ut' && state.type !== 'ut') shouldShow = false;
                   }
                   
                   // Search filter
                   if (this.searchTerm && !state.name.toLowerCase().includes(this.searchTerm)) {
                       shouldShow = false;
                   }
                   
                   // Year filter (only show formed states)
                   if (state.yearFormed > this.currentYear) {
                       shouldShow = false;
                   }
                   
                   // Apply visibility
                   if (shouldShow) {
                       if (!this.map.hasLayer(marker)) {
                           marker.addTo(this.map);
                       }
                       marker.setStyle({ opacity: 1, fillOpacity: 0.8 });
                   } else {
                       if (this.map.hasLayer(marker)) {
                           marker.setStyle({ opacity: 0.3, fillOpacity: 0.2 });
                       }
                   }
               });
           }

           showMilestone(text) {
               const banner = document.getElementById('milestoneBanner');
               banner.textContent = text;
               banner.classList.add('show');
               
               setTimeout(() => {
                   banner.classList.remove('show');
               }, 3000);
           }

           showLoading(show) {
               let loadingEl = document.querySelector('.loading');
               
               if (show && !loadingEl) {
                   loadingEl = document.createElement('div');
                   loadingEl.className = 'loading';
                   loadingEl.innerHTML = `
                       <div class="spinner"></div>
                       <div>Loading Bharat's State Formation Data...</div>
                       <small>Preparing historical insights and AI analysis</small>
                   `;
                   document.querySelector('.map-container').appendChild(loadingEl);
               } else if (!show && loadingEl) {
                   loadingEl.remove();
               }
           }

           showError(message) {
               const errorEl = document.createElement('div');
               errorEl.className = 'error';
               errorEl.innerHTML = `
                   <i class="fas fa-exclamation-triangle"></i>
                   <div>
                       <strong>Error:</strong> ${message}
                       <br><small>Please refresh the page to try again.</small>
                   </div>
               `;
               
               document.querySelector('.controls-panel').insertBefore(
                   errorEl, 
                   document.querySelector('.controls')
               );
               
               setTimeout(() => errorEl.remove(), 10000);
           }
       }

       // Initialize the application
       document.addEventListener('DOMContentLoaded', () => {
           new BharatStateFormationMap();
       });

       // Add custom styles for popup
       const style = document.createElement('style');
       style.textContent = `
           .custom-popup .leaflet-popup-content-wrapper {
               background: rgba(30, 41, 59, 0.95);
               backdrop-filter: blur(15px);
               border-radius: 12px;
               box-shadow: 0 15px 50px rgba(0, 0, 0, 0.3);
               border: 1px solid rgba(37, 99, 235, 0.3);
               color: #f8fafc;
           }
           
           .custom-popup .leaflet-popup-tip {
               background: rgba(30, 41, 59, 0.95);
               border: 1px solid rgba(37, 99, 235, 0.3);
           }
           
           .leaflet-popup-content {
               margin: 0 !important;
           }

           .leaflet-popup-close-button {
               color: #f8fafc !important;
               font-size: 16px !important;
               font-weight: bold !important;
           }

           .leaflet-popup-close-button:hover {
               color: #2563eb !important;
           }

           .leaflet-control-zoom a {
               background-color: rgba(30, 41, 59, 0.9) !important;
               color: #f8fafc !important;
               border: 1px solid rgba(37, 99, 235, 0.3) !important;
           }

           .leaflet-control-zoom a:hover {
               background-color: rgba(37, 99, 235, 0.8) !important;
           }

           .leaflet-control-attribution {
               background-color: rgba(30, 41, 59, 0.8) !important;
               color: #64748b !important;
               font-size: 10px !important;
           }

           .leaflet-control-scale-line {
               background-color: rgba(30, 41, 59, 0.8) !important;
               color: #f8fafc !important;
               border: 1px solid rgba(37, 99, 235, 0.3) !important;
           }
       `;
       document.head.appendChild(style);
   </script>
</body>
</html>